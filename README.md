# uplab-2023-test-ex
### Задание №1: 
Создать файл getNews2015.php, который будет отдавать массив новостей из инфоблока id 12, за 2015 год в формате JSON.

В результирующем массиве описывающий элемент (новость) должны быть поля:
* id - id элемента
* url - ссылка на новость
* image - ссылка на превью картинку новости
* name - название новости
* sectionName - название раздела элемента
* date - дата новости вида “12 декабря 2015 12:59” (день месяц год часы минуты)
* author - автор новости (свойство инфоблока типа “Привязка к элементам с автозаполнением”. Нужно вывести имя)
* tags - массив тегов

#### Ответ:
**@link** [ссылка на файл: includes/getNews2015.php](includes/getNews2015.php) <br><br>
**@see api**: `GET` http://89.111.136.61/public/api/news/

**примечания:**
* используется `IBLOCK_ID = 55` , таблица с пропсами `b_iblock_element_prop_s55` заканчивается на id инфоблока. **НЕ id = 12!**.


<br><br>
### Задание №2: найдите и перечислите все имеющиеся ошибки и проблемы в коде

```php
1. <?php
2.    include('includes/db.php');
3.    $login = $_POST['login'];
4.    $password = $_POST['password'];
5.    $count = mysqli_query($connection, "SEL ECT * FR OM users WHERE login = '$login' AND `password`= '$password'");
6.    if (mysqli_num_rows($count) == 0 )
7.    {
8.        header("Location: /user_mode.php", 3000);
9.    } else
10.   {
11.       header("Location: /user.php", 3000);
12    }
13 ?>
```
#### Ответ:
1. Можно использовать шорт-тег `<?` при включенной директиве `short_open_tag` в `php.ini`, Но не рекомендуется.
```php 
1. <?php
```

2. Нужно использовать функцию `require()` , а лучше `require_once()` (если проект большой), 
*т.к. если файл отсутствует функция `include()` выбросит предупреждение и исполнение кода продолжится, что не имеет смысла, т.к. объект хендлер-коннекта к базе **не определен**. Лучше получить ошибку на этом этапе и обработать её.*
    <br><br>
    Поместить весь код ниже в `try {  } catch` <br><br>
    Файл `'includes/db.php'` может не подключиться из-за отсутствия слэша `/` первым символом, если будет исполняться на сервере.
   <br><br>
    Если это битрикс, то подключение базы вызывается через `Bitrix\Main\Application::getConnection('db_name')` , файл в `/bitrix/php_interface/dbconn/`
```php 
2.    include('includes/db.php');
```

3. Возможно логин и пароль передаются в открытом виде.
4. _
   <br><br>
   В данном примере лучше использовать заголовок авторизации HTTP запроса и получить данные `admin:admin123` пример: `--header 'Authorization: Basic YWRtaW46YWRtaW4xMjM='` , а в таблице хранить значение хэша для поиска, или использовать более новейшие методы авторизации и продуманную струкруту таблицы.
```php
3.    $login = $_POST['login'];
4.    $password = $_POST['password'];
```

5. `'SEL ECT * FR OM` не выполниться будет синтаксическая ошибка. <br><br>
    `$connection` будем считать что переменная определена в файле `'includes/db.php'` <br><br>
    для `$count` надо использовать `COUNT(*)`<br><br>
    есть возможность для иньекций в выражение SQL <br><br>
    **-** процедурный стиль в 2023 , лучше использовать `PDO` , или цеплять процедуры и функции из БД
```php
$count = mysqli_query($connection, "SEL ECT * FR OM users WHERE login = '$login' AND `password`= '$password'");
```

6. **с 6. по 12. строку**<br><br>
    `mysqli_num_rows($count)` кастануть к `int`<br><br>
    Второй аргумент фукнции `header()`, `bool $replace` , лучше передать через именованные аргументы: `header(header: 'Location: /user_mode.php', response_code: 303);`<br><br>
    Коды перенаправлений `3xx`<br><br>
    Добавить `exit;` после `header()`<br><br>
    можно переписать блок кода и ограничиться только `if`
```php
6.    if (mysqli_num_rows($count) == 0 )
7.    {
8.        header("Location: /user_mode.php", 3000);
9.    } else
10.   {
11.       header("Location: /user.php", 3000);
12    }
```

7. Тег Можно опустить, если нет элементов ниже, но добавить переход на новую строку (*видел где то в стандартах PSR*) 
```php
13 ?>
```